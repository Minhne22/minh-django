<h3>ğŸ”— Danh sÃ¡ch Links</h3>

<!-- Báº£ng hiá»ƒn thá»‹ links -->
<table class="table">
    <thead>
        <tr>
            <th>STT</th>
            <th>URL</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>HÃ nh Ä‘á»™ng</th>
        </tr>
    </thead>
    <tbody id="linksTable"></tbody>
</table>

<script>
    $(document).ready(function () {
        function loadLinks() {
            $.ajax({
                url: "{% url 'get_links' %}",
                type: "GET",
                success: function (response) {
                    let rows = "";
                    response.links.forEach((link, index) => {
                        let isHidden = link.status === "hidden";
                        let statusText = isHidden ? "ğŸš« áº¨n" : "âœ… Hiá»‡n";
                        let buttonText = isHidden ? "ğŸ‘ Hiá»‡n" : "ğŸš« áº¨n";
                        let buttonClass = isHidden ? "btn-success" : "btn-warning";

                        rows += `<tr id="linkRow-${index}">
                            <td>${index + 1}</td>
                            <td>${link.url}</td>
                            <td id="status-${index}">${statusText}</td>
                            <td>
                                <button class="btn ${buttonClass} btn-sm toggle-link" 
                                        data-url="${link.url}" data-index="${index}">
                                    ${buttonText}
                                </button>
                                <button class="btn btn-danger btn-sm delete-link" 
                                        data-url="${link.url}" data-index="${index}">
                                    âŒ XÃ³a
                                </button>
                            </td>
                        </tr>`;
                    });
                    $("#linksTable").html(rows);
                }
            });
        }

        loadLinks(); // Load dá»¯ liá»‡u khi trang má»Ÿ

        // Toggle áº¨n/Hiá»‡n
        $(document).on("click", ".toggle-link", function () {
            let url = $(this).data("url");
            let index = $(this).data("index");
            let button = $(this);

            $.ajax({
                url: "{% url 'toggle_link' %}",
                type: "POST",
                data: { "url": url, "csrfmiddlewaretoken": "{{ csrf_token }}" },
                success: function (response) {
                    let isHidden = response.new_status === "hidden";
                    $(`#status-${index}`).text(isHidden ? "ğŸš« áº¨n" : "âœ… Hiá»‡n");

                    // Cáº­p nháº­t nÃºt
                    button.toggleClass("btn-warning btn-success")
                          .text(isHidden ? "ğŸ‘ Hiá»‡n" : "ğŸš« áº¨n");
                }
            });
        });

        // XÃ³a link
        $(document).on("click", ".delete-link", function () {
            let url = $(this).data("url");
            let index = $(this).data("index");

            $.ajax({
                url: "{% url 'delete_link' %}",
                type: "POST",
                data: { "url": url, "csrfmiddlewaretoken": "{{ csrf_token }}" },
                success: function () {
                    $(`#linkRow-${index}`).remove();
                }
            });
        });
    });
</script>
