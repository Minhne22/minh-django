<h3>ğŸ”— Danh sÃ¡ch Links</h3>

<!-- Hiá»ƒn thá»‹ thÃ´ng bÃ¡o -->
<div id="message" class="alert" style="display: none;"></div>

<!-- Báº£ng hiá»ƒn thá»‹ links -->
<table class="table">
    <thead>
        <tr>
            <th>STT</th>
            <th>URL</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>HÃ nh Ä‘á»™ng</th>
        </tr>
    </thead>
    <tbody id="linksTable"></tbody>
</table>

<script>
    $(document).ready(function () {
        // Load danh sÃ¡ch links tá»« database
        function loadLinks() {
            $.ajax({
                url: "{% url 'get_links' %}",
                type: "GET",
                success: function (response) {
                    let rows = "";
                    response.links.forEach((link, index) => {
                        let statusText = link.status === "hidden" ? "ğŸš« áº¨n" : "âœ… Hiá»‡n";
                        rows += `<tr id="linkRow-${index}">
                            <td>${index + 1}</td>
                            <td>${link.url}</td>
                            <td id="status-${index}">${statusText}</td>
                            <td>
                                <button class="btn btn-warning btn-sm hide-link" data-url="${link.url}" data-index="${index}">ğŸ‘ áº¨n</button>
                                <button class="btn btn-danger btn-sm delete-link" data-url="${link.url}" data-index="${index}">âŒ XÃ³a</button>
                            </td>
                        </tr>`;
                    });
                    $("#linksTable").html(rows);
                },
                error: function () {
                    $("#message").addClass("alert-danger").text("KhÃ´ng thá»ƒ táº£i dá»¯ liá»‡u!").show();
                }
            });
        }

        loadLinks();  // Gá»i khi trang load

        // áº¨n link
        $(document).on("click", ".hide-link", function () {
            let url = $(this).data("url");
            let index = $(this).data("index");

            $.ajax({
                url: "{% url 'hide_link' %}",
                type: "POST",
                data: { "url": url, "csrfmiddlewaretoken": "{{ csrf_token }}" },
                success: function () {
                    $(`#status-${index}`).text("ğŸš« áº¨n");
                }
            });
        });

        // XÃ³a link
        $(document).on("click", ".delete-link", function () {
            let url = $(this).data("url");
            let index = $(this).data("index");

            $.ajax({
                url: "{% url 'delete_link' %}",
                type: "POST",
                data: { "url": url, "csrfmiddlewaretoken": "{{ csrf_token }}" },
                success: function () {
                    $(`#linkRow-${index}`).remove();
                }
            });
        });
    });
</script>
